# Configuration file for the DINO detector
# Filename convention: 
#   - {detector}-{backbone}.yaml

# Currently based on the config: https://github.com/IDEA-Research/DINO/blob/main/config/DINO/DINO_4scale.py
---
detector: "dino"

backbone: "resnet50"

backbone_params:
  return_levels: [1, 2, 3]
  backbone_freeze_keywords: TODO see if I need this


positional_embedding_params:
  # The height and width temperature of the positional embedding equation (attention is all you need);
  # see models.layers.positional for more details
  pe_temperature_h: 40
  pe_temperature_w: 40

  # row/col normalize the poisitonal coordinates [0, 2pi)
  normalize: True

denoising_params:

# TODO: group these better
dino_params:
  # Model architecture params
  num_feature_levels: 4

  hidden_dim: 256 # TODO: might move to transformer parameters

  # Number of learned_object_queries are inputinto the decoder; maximum number of object 
  # predictions dino will produce (each a bounding box and class)
  num_queries: 900

  num_feature_levels: 4
  num_heads: 8

  # TODO: Comment
  query_dim: 4
  random_refpoints_xy: False
  fix_refpoints_hw: -1 # comment the options




  # Other DINO params (maybe put these under their own key)

  # TODO; comment
  dec_pred_class_embed_share: True
  dec_pred_bbox_embed_share: True

  # TODO: comment
  two_stage_type: "standard" # comment options if they exist
  two_stage_add_query_num: 0
  two_stage_bbox_embed_share: False
  two_stage_class_embed_share: False

  # TODO: comment
  decoder_self_attn_type: "sa" # ["sa", "ca_label", "ca_content"]
  num_patterns: 0

  # Number of denoising_queries for an image; will be evenly distributed to each GT object 
  # in the image based on the num_objects for the image w/ the most objects in the batch; therefore 
  # images in the batch w/ less objects will have more denoise queries per GT; additionally, 
  # denoise_number will be multiplied by 2 use positive and negative queries; 
  # e.g., if the image with the higheset num_objects is 6, there will be at least 
  # (100//6)*2 = 32 denoise queries per GT object
  denoise_number: 100

  # NOTE: the bash script overrides this parameter to 1.0, which is different than the config
  denoise_box_noise_scale: 1.0

  denoise_label_noise_ratio: 0.5 

  # TODO rename and see if I can just use the number of classes in the dataset
  denoise_labelbook_size: 91





  



